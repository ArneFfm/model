name: CI

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        php: [5.6, 7.0, 7.1, 7.2, 7.3]
    container:
      image: php:${{ matrix.php }}-cli
    steps:
    - uses: actions/checkout@v1
    - name: Install composer
      run: |
        apt-get update; \
        apt-get install -y wget git zip unzip;
        VERSION="$(php -r "echo PHP_MAJOR_VERSION . '.' .PHP_MINOR_VERSION;")" ; \
        if [ "${VERSION}" = "5.6" ]; then \
          pecl install xdebug-2.5.5; \
        else \
          pecl install xdebug-2.7.2; \
        fi;
        docker-php-ext-enable xdebug; \
        wget -qO- https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer;
    - name: Show php version
      run: php -v
    - name: Install dependencies
      run: composer install --prefer-source
    - name: Current directory
      run: pwd && ls -alt vendor/bin
    - name: Run unit tests
      run: ./vendor/bin/phpunit --coverage-clover clover.xml
    - name: Show Coverage
      run: ./vendor/bin/php-coveralls -v